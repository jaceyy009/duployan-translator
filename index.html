<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duployan Translator (Upgraded)</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; background: #f9f9f9; }
        h1 { text-align: center; color: #222; }
        .container { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        textarea, select, button { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; }
        button { background: #4CAF50; color: white; cursor: pointer; }
        button:hover { background: #45a049; }
        #output { background: #f0f8ff; padding: 15px; border-radius: 6px; white-space: pre-wrap; min-height: 80px; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #e3f2fd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Duployan Translator (Improved)</h1>
        <p>Try a simple sentence like: "I see the big world" or "We will learn language". Round-trip should now be much better.</p>

        <label>Enter English or Duployan:</label>
        <textarea id="input" rows="3" placeholder="Type here..."></textarea>

        <label>Direction:</label>
        <select id="dir">
            <option value="en2dup">English â†’ Duployan</option>
            <option value="dup2en">Duployan â†’ English</option>
        </select>

        <button onclick="translate()">Translate</button>
        <button onclick="document.getElementById('input').value = ''; document.getElementById('output').innerHTML = '';">Clear</button>

        <div id="output"></div>
    </div>

    <script>
        // Full core vocabulary from your documents (accurate symbols & pron)
        const vocab = {
            // Pronouns
            'i':         {dup: 'ð›±ˆ',     pron: 'eeh'},
            'you':       {dup: 'ð›°‘ð›±‘',   pron: 'th-u'},
            'he':        {dup: 'ð›°€ð›±†',   pron: 'hee'},
            'she':       {dup: 'ð›°†ð›±†',   pron: 'lee'},
            'we':        {dup: 'ð›°‰ð›±†',   pron: 'vee'},
            'they':      {dup: 'ð›°‘ð›±’',   pron: 'th-eu'},
            'it':        {dup: 'ð›±‹ð›°‘',   pron: 'eeh-th'},

            // Core verbs
            'be':        {dup: 'ð›°‘ð›±',   pron: 'tha'},
            'have':      {dup: 'ð›°™ð›±†',   pron: 'mee'},
            'go':        {dup: 'ð›°…ð›£¼',   pron: 'ko'},
            'come':      {dup: 'ð›°…ð›±ð›°™', pron: 'kam'},
            'see':       {dup: 'ð›°œð›±†',   pron: 'see'},
            'say':       {dup: 'ð›°œð›±ð›°†', pron: 'sal'},
            'speak':     {dup: 'ð›°œð›±ð›°†', pron: 'sal'},
            'learn':     {dup: 'ð›°†ð›£¼ð›°š', pron: 'lon'},
            'know':      {dup: 'ð›°šð›£¼',   pron: 'no'},
            'make':      {dup: 'ð›°™ð›±ð›°…', pron: 'mak'},
            'use':       {dup: 'ð›°‘ð›±•ð›°œ', pron: 'th-oos'},

            // Time & basics
            'now':       {dup: 'ð›°‘',     pron: 'th'},
            'before':    {dup: 'ð›°ƒð›±‚',   pron: 'tow-uh'},
            'after':     {dup: 'ð›°‹ð›±',   pron: 'ra'},
            'day':       {dup: 'ð›°‹ð›£¼',   pron: 'ro'},
            'today':     {dup: 'ð›°‹ð›£¼ð›°‘', pron: 'ro-th'},
            'always':    {dup: 'ð›°œð›£¼ð›°†', pron: 'sol'},
            'never':     {dup: 'ð›°šð›±ð›°œ', pron: 'nas'},

            // People
            'person':    {dup: 'ð›°™ð›±†ð›°š', pron: 'meen'},
            'people':    {dup: 'ð›°™ð›±†ð›°šð›°œ', pron: 'meens'},
            'man':       {dup: 'ð›°™ð›±†ð›°š', pron: 'meen'},
            'woman':     {dup: 'ð›°™ð›±†ð›°šð›±', pron: 'meen-wo'},
            'child':     {dup: 'ð›°‡ð›±',   pron: 'ban'},
            'friend':    {dup: 'ð›°„ð›±†ð›°†', pron: 'feel'},

            // World & concepts
            'world':     {dup: 'ð›°™ð›£¼ð›°š', pron: 'mon'},
            'language':  {dup: 'ð›°†ð›±ð›°œð›±†', pron: 'la-see'},
            'word':      {dup: 'ð›°œð›£¼ð›°‹', pron: 'sor'},
            'meaning':   {dup: 'ð›°™ð›±†ð›°œ', pron: 'mees'},
            'name':      {dup: 'ð›°šð›±ð›°™', pron: 'nam'},
            'truth':     {dup: 'ð›°ƒð›±ð›°œ', pron: 'tas'},
            'idea':      {dup: 'ð›±ð›°†ð›±†', pron: 'a-lee'},

            // Modifiers
            'good':      {dup: 'ð›°„ð›£¼',   pron: 'fo'},
            'bad':       {dup: 'ð›°„ð›±ð›°œ', pron: 'fas'},
            'big':       {dup: 'ð›°…ð›±',   pron: 'ka'},
            'small':     {dup: 'ð›°œð›±ð›°†', pron: 'sal'},
            'new':       {dup: 'ð›°šð›±•',   pron: 'noo'},
            'old':       {dup: 'ð›°‹ð›£¼ð›°†', pron: 'rol'},

            // Function
            'and':       {dup: 'ð›°œ',     pron: 's'},
            'or':        {dup: 'ð›°‹',     pron: 'r'},
            'not':       {dup: 'ð›°š',     pron: 'n'},
            'yes':       {dup: 'ð›°œð›±†',   pron: 'see'},
            'no':        {dup: 'ð›°šð›£¼',   pron: 'no'},

            // Particles (used as prefixes)
            'past':      {dup: 'ð›°ƒð›±‚',   pron: 'tow-uh'},
            'future':    {dup: 'ð›°‹ð›±',   pron: 'ra'},
            'progressive': {dup: 'ð›°œð›±†', pron: 'see'},
        };

        const dupToEng = {};
        for (let eng in vocab) {
            dupToEng[vocab[eng].dup] = eng;
        }

        function translate() {
            const text = document.getElementById('input').value.trim();
            const dir = document.getElementById('dir').value;
            let out = '';

            if (!text) {
                out = 'Please enter some text.';
            } else if (dir === 'en2dup') {
                const [dup, pron] = engToDup(text);
                out = `Duployan: ${dup}\nPron: ${pron}`;
            } else {
                const eng = dupToEngF(text);
                out = `English: ${eng}`;
            }

            document.getElementById('output').textContent = out;
        }

        function engToDup(sentence) {
            let words = sentence.toLowerCase().replace(/[^\w\s]/g, '').split(/\s+/);
            let tense = 'current';
            if (words.includes('will') || words.includes('would')) tense = 'future';
            if (words.some(w => ['was','did','went','had','made'].includes(w))) tense = 'past';

            let verb = null, subject = null, objects = [], mods = [];

            for (let w of words) {
                if (vocab[w]) {
                    if (['i','you','he','she','we','they','it'].includes(w)) subject = w;
                    else if (Object.keys(vocab).includes(w) && w !== subject) verb = w;  // first non-subject verb
                    else objects.push(w);
                } else if (w.endsWith('s') && vocab[w.slice(0,-1)]) {
                    // simple plural guess
                    objects.push(w.slice(0,-1) + '-plural');
                }
            }

            if (!verb || !subject) return ['Cannot parse sentence (need verb + subject)', ''];

            let dupParts = [vocab[tense].dup];                      // tense particle first
            dupParts.push(vocab[verb].dup);                         // verb
            dupParts.push(vocab[subject].dup);                      // subject
            if (objects.length) dupParts.push(objects.map(w => vocab[w]?.dup || '?').join(' '));

            let pronParts = [vocab[tense].pron, vocab[verb].pron, vocab[subject].pron];
            if (objects.length) pronParts.push(objects.map(w => vocab[w]?.pron || w).join(' '));

            return [dupParts.filter(Boolean).join(' '), pronParts.filter(Boolean).join(' - ')];
        }

        function dupToEngF(dupStr) {
            let tokens = dupStr.split(/\s+/);
            if (tokens.length < 2) return 'Invalid Duployan input';

            let tenseDup = tokens[0];
            let verbDup = tokens[1];
            let subjDup = tokens[2];
            let objDups = tokens.slice(3);

            let tenseEng = dupToEng[tenseDup] || 'now';
            let verbEng = dupToEng[verbDup] || '[?]';
            let subjEng = dupToEng[subjDup] || '[?]';
            let objEng = objDups.map(t => dupToEng[t] || t).join(' ');

            let out = `${subjEng} ${verbEng}`;
            if (objEng) out += ` ${objEng}`;
            if (tenseEng === 'past') out = `${subjEng} did ${verbEng} ${objEng}`;
            if (tenseEng === 'future') out = `${subjEng} will ${verbEng} ${objEng}`;

            return out.trim() || 'Could not translate back';
        }
    </script>
</body>
</html>
