<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duployan Translator</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Duployan&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Duployan', Arial, sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; background: #f9f9f9; }
        h1 { text-align: center; color: #222; }
        .container { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        textarea, select, button { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; }
        button { background: #4CAF50; color: white; cursor: pointer; }
        button:hover { background: #45a049; }
        #output { background: #f0f8ff; padding: 15px; border-radius: 6px; white-space: pre-wrap; min-height: 100px; margin-top: 15px; font-size: 18px; }
        .note { color: #666; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Duployan Translator (Fixed)</h1>
        <p class="note">Now using Noto Sans Duployan font â€” symbols should display correctly (no boxes). Test round-trip with your sentence.</p>

        <textarea id="input" rows="4" placeholder="e.g. Keep it down in here, or your friends will have to leave."></textarea>

        <select id="dir">
            <option value="en2dup">English â†’ Duployan</option>
            <option value="dup2en">Duployan â†’ English</option>
        </select>

        <button onclick="translateText()">Translate</button>
        <button onclick="clearAll()">Clear</button>

        <div id="output"></div>
    </div>

    <script>
        const vocab = {
            'i':         {dup: 'ð›±ˆ', pron: 'eeh'},
            'you':       {dup: 'ð›°‘ð›±‘', pron: 'th-u'},
            'he':        {dup: 'ð›°€ð›±†', pron: 'hee'},
            'she':       {dup: 'ð›°†ð›±†', pron: 'lee'},
            'we':        {dup: 'ð›°‰ð›±†', pron: 'vee'},
            'they':      {dup: 'ð›°‘ð›±’', pron: 'th-eu'},
            'it':        {dup: 'ð›±‹ð›°‘', pron: 'eeh-th'},
            'be':        {dup: 'ð›°‘ð›±', pron: 'tha'},
            'have':      {dup: 'ð›°™ð›±†', pron: 'mee'},
            'go':        {dup: 'ð›°…ð›£¼', pron: 'ko'},
            'come':      {dup: 'ð›°…ð›±ð›°™', pron: 'kam'},
            'see':       {dup: 'ð›°œð›±†', pron: 'see'},
            'say':       {dup: 'ð›°œð›±ð›°†', pron: 'sal'},
            'learn':     {dup: 'ð›°†ð›£¼ð›°š', pron: 'lon'},
            'know':      {dup: 'ð›°šð›£¼', pron: 'no'},
            'make':      {dup: 'ð›°™ð›±ð›°…', pron: 'mak'},
            'use':       {dup: 'ð›°‘ð›±•ð›°œ', pron: 'th-oos'},
            'keep':      {dup: 'ð›°šð›±•ð›°‹', pron: 'noor'},  // hold/keep
            'down':      {dup: 'ð›°‡ð›±‘ð›°…', pron: 'buk'},
            'here':      {dup: 'ð›±ˆð›°‹', pron: 'eehr'},
            'your':      {dup: 'ð›±†ð›°œð›£¼', pron: 'eeso'},
            'leave':     {dup: 'ð›±‚ð›°„', pron: 'owuhf'},
            'now':       {dup: 'ð›°‘', pron: 'th'},
            'before':    {dup: 'ð›°ƒð›±‚', pron: 'tow-uh'},
            'after':     {dup: 'ð›°‹ð›±', pron: 'ra'},
            'past':      {dup: 'ð›°ƒð›±‚', pron: 'tow-uh'},
            'future':    {dup: 'ð›°‹ð›±', pron: 'ra'},
            'progressive': {dup: 'ð›°œð›±†', pron: 'see'}
            // Add more from your PDFs as needed
        };

        const dupToEng = {};
        for (let eng in vocab) dupToEng[vocab[eng].dup] = eng;

        function translateText() {
            const text = document.getElementById('input').value.trim();
            const dir = document.getElementById('dir').value;
            let output = '';

            if (!text) {
                output = 'Enter a sentence.';
            } else if (dir === 'en2dup') {
                const [dup, pron] = englishToDuployan(text);
                output = `Duployan: ${dup}\nPronunciation: ${pron}`;
            } else {
                const eng = duployanToEnglish(text);
                output = `English (reconstructed): ${eng}`;
            }

            document.getElementById('output').textContent = output;
        }

        function clearAll() {
            document.getElementById('input').value = '';
            document.getElementById('output').textContent = '';
        }

        function englishToDuployan(sentence) {
            let words = sentence.toLowerCase().replace(/[^\w\s']/g, '').split(/\s+/);
            let tense = 'current';
            if (words.includes('will')) tense = 'future';
            if (words.some(w => ['was','did','had','went','made'].includes(w))) tense = 'past';

            let subject = null, verb = null, objects = [], particles = [];

            // Improved detection
            for (let w of words) {
                if (vocab[w]) {
                    if (['i','you','he','she','we','they','it'].includes(w)) subject = w;
                    else if (['be','have','go','come','see','say','learn','know','make','use','keep','leave'].includes(w)) {
                        if (!verb) verb = w;
                    } else {
                        objects.push(w);
                    }
                } else if (w === 'or') {
                    particles.push('or');
                }
            }

            if (!verb || !subject) return ['Parse failed (need subject + verb)', ''];

            let dupParts = [vocab[tense].dup];
            if (verb === 'keep' && objects.includes('down')) {
                // Special case for "keep down"
                dupParts.push(vocab['keep'].dup + ' ' + vocab['down'].dup);
            } else {
                dupParts.push(vocab[verb].dup);
            }
            dupParts.push(vocab[subject].dup);

            // Objects + your special words
            let objDups = [];
            for (let o of objects) {
                if (vocab[o]) objDups.push(vocab[o].dup);
                else if (o === 'the' || o === 'all' || o === 'in') objDups.push(o); // preserve articles/preps literally
                else if (o.endsWith('s')) objDups.push((vocab[o.slice(0,-1)]?.dup || o.slice(0,-1)) + 'ð›°œ');
            }
            if (objDups.length) dupParts.push(objDups.join(' '));

            let pronParts = [vocab[tense].pron, vocab[verb].pron || '', vocab[subject].pron || ''];
            if (objDups.length) pronParts.push(objDups.map(d => vocab[d]?.pron || d).join(' '));

            return [dupParts.filter(Boolean).join(' '), pronParts.filter(Boolean).join(' - ')];
        }

        function duployanToEnglish(dupStr) {
            let tokens = dupStr.split(/\s+/).filter(Boolean);
            if (tokens.length < 2) return 'Invalid Duployan input';

            let tense = dupToEng[tokens[0]] || 'current';
            let verbToken = tokens[1];
            let subject = dupToEng[tokens[2]] || '[?]';
            let objs = tokens.slice(3).map(t => dupToEng[t] || t);

            let verb = dupToEng[verbToken] || verbToken;
            // Special cases
            if (verbToken.includes(vocab['keep'].dup)) verb = 'keep';
            if (verbToken.includes(vocab['down'].dup)) verb += ' down';

            let result = `${subject} ${verb}`;
            if (objs.length) result += ` ${objs.join(' ')}`;

            // Improve tense phrasing
            if (tense === 'past') result = `${subject} did ${verb} ${objs.join(' ')}`;
            if (tense === 'future') result = `${subject} will ${verb} ${objs.join(' ')}`;

            return result.trim();
        }
    </script>
</body>
</html>
